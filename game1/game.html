<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Card Game - Lok Sabha Elections 2024</title>
    <style>
        :root {
            --primary-color: #f47216;
            --secondary-color: #2b5797;
            --accent-color: #00a550;
            --light-bg: #f5f5f5;
            --dark-bg: #333;
            --text-color: #333;
            --light-text: #fff;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.2);
            --border-radius: 10px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        
        header h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .game-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        button {
            background-color: var(--secondary-color);
            color: var(--light-text);
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #1e3c6b;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .reset-btn {
            background-color: #d9534f;
        }
        
        .reset-btn:hover {
            background-color: #c9302c;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .scoreboard {
            background-color: var(--secondary-color);
            color: var(--light-text);
            padding: 20px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .score-section {
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        
        .scoreboard h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .score-detail {
            font-size: 1.2rem;
            margin: 5px 0;
        }
        
        .current-innings {
            font-weight: bold;
            background-color: var(--accent-color);
            color: var(--light-text);
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .match-stats {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            text-align: center;
            min-width: 120px;
        }
        
        .stat-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--secondary-color);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .board {
            display: flex;
            flex-direction: column;
            gap: 40px;
        }
        
        .play-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .card-played {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .card-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .card {
            position: relative;
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
            height: auto;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .card-body {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            max-height: 350px;
        }
        
        .card-info {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .info-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .info-value {
            text-align: right;
        }
        
        .party-tag {
            background-color: var(--secondary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .action-area {
            margin-top: 30px;
        }
        
        .card-selection {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .player-cards {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .player-card {
            width: 180px;
            height: 280px;
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .player-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .mini-card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 5px;
            text-align: center;
            font-size: 0.75rem;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mini-player-image {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }
        
        .mini-card-body {
            padding: 8px;
            font-size: 0.75rem;
            flex: 1;
            overflow-y: auto;
        }
        
        .mini-card-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .mini-info-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .mini-card-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        
        .mini-info-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .game-log {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            box-shadow: var(--card-shadow);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
            text-align: center;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .log-highlight {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .hidden {
            display: none;
        }
        
        .result-highlight {
            font-size: 1.5rem;
            color: var(--accent-color);
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .ball-result {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .wicket {
            color: #d9534f;
        }

        .runs {
            color: var(--accent-color);
        }
        
        /* New styles for outcome area and next ball button */
        .outcome-area {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px auto;
            box-shadow: var(--card-shadow);
            text-align: center;
            max-width: 600px;
        }
        
        .outcome-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .outcome-message {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .next-ball-btn {
            background-color: var(--accent-color);
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .next-ball-btn:hover {
            background-color: #008c45;
        }
        
        /* Card refresh styles */
        .refresh-info {
            background-color: var(--secondary-color);
            color: var(--light-text);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: inline-block;
        }
        
        .card-refresh-highlight {
            background-color: rgba(0, 165, 80, 0.1);
            border: 2px solid var(--accent-color);
            transform: translateY(-3px);
        }
        
        .discard-btn {
            background-color: #d9534f;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin-top: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .card-count {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .final-scoreboard {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
        }
        
        .final-score-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--secondary-color);
            text-align: center;
        }
        
        .final-score-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .final-score-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        /* New styles for ball outcome display and innings summary */
        .results-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }
        
        .ball-outcome-display {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            text-align: center;
        }
        
        .ball-outcome-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .ball-outcome-result {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .ball-outcome-details {
            font-size: 1.1rem;
            margin: 10px 0;
        }
        
        .innings-summary-display {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        
        .innings-summary-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cricket Card Game - Lok Sabha Elections 2024</h1>
            <p>Use election candidate cards to play cricket!</p>
        </header>
    </div>
        
        <div id="start-screen">
            <h2 style="text-align: center; margin-bottom: 20px;">Choose Your Strategy</h2>
            <div class="game-options">
                <button id="bat-first-btn">Bat First</button>
                <button id="bowl-first-btn">Bowl First</button>
            </div>
        </div>
        
        <div id="game-screen" class="hidden">
            <div class="game-options">
                <button id="reset-btn" class="reset-btn">Reset Game</button>
            </div>
            
            <div class="game-area">
                <div class="scoreboard">
                    <div class="score-section">
                        <h2>Your Score</h2>
                        <p class="score-detail">Runs: <span id="user-runs">0</span>/<span id="user-wickets">0</span></p>
                        <p class="score-detail">Overs: <span id="user-overs">0.0</span></p>
                        <p id="user-innings-indicator" class="current-innings hidden">Batting Now</p>
                    </div>
                    <div class="score-section">
                        <h2>Target</h2>
                        <p class="score-detail"><span id="target-runs">-</span></p>
                    </div>
                    <div class="score-section">
                        <h2>Computer Score</h2>
                        <p class="score-detail">Runs: <span id="comp-runs">0</span>/<span id="comp-wickets">0</span></p>
                        <p class="score-detail">Overs: <span id="comp-overs">0.0</span></p>
                        <p id="comp-innings-indicator" class="current-innings hidden">Batting Now</p>
                    </div>
                </div>
                
                <div class="match-stats">
                    <div class="stat-box">
                        <div class="stat-title">Over</div>
                        <div id="current-over" class="stat-value">0.0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">Ball</div>
                        <div id="ball-count" class="stat-value">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">Required</div>
                        <div id="req-runs" class="stat-value">-</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">Run Rate</div>
                        <div id="run-rate" class="stat-value">0.00</div>
                    </div>
                </div>
                
                <!-- New results container for ball outcome and innings summary -->
                <div class="results-container">
                    <div id="ball-outcome-display" class="ball-outcome-display hidden">
                        <div class="ball-outcome-title">Last Ball Outcome</div>
                        <div id="ball-outcome-result" class="ball-outcome-result">4 RUNS!</div>
                        <div id="ball-outcome-details" class="ball-outcome-details">Vote share difference (12.5%) is between 12-15%. 4 runs scored.</div>
                    </div>
                    
                    <div id="innings-summary-display" class="innings-summary-display hidden">
                        <div class="innings-summary-title">Innings Summary</div>
                        <div id="innings-summary-content">
                            <p>First innings completed! Final score: 120/4 in 6.0 overs.</p>
                            <p>Target: 121 runs to win.</p>
                        </div>
                    </div>
                </div>
                
                <div id="ball-result-display" class="hidden">
                    <div id="ball-result" class="ball-result">4 RUNS!</div>
                </div>
                
                <div class="board">
                    <div class="play-area">
                        <div class="card-played">
                            <div class="card-title">Bowler's Card</div>
                            <div id="bowler-card" class="card">
                                <div class="card-header">Select a card to start</div>
                                <img src="/api/placeholder/400/180" alt="Candidate Photo" class="player-image">
                                <div class="card-body">
                                    <div class="card-info">
                                        <span class="info-label">Party:</span>
                                        <span class="info-value party-tag">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Age:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Gender:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Vote Share:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Rank:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Constituency:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">State:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Type:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Turnout:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Margin:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Female Turnout Edge:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-played">
                            <div class="card-title">Batter's Card</div>
                            <div id="batter-card" class="card">
                                <div class="card-header">Select a card to start</div>
                                <img src="/api/placeholder/400/180" alt="Candidate Photo" class="player-image">
                                <div class="card-body">
                                    <div class="card-info">
                                        <span class="info-label">Party:</span>
                                        <span class="info-value party-tag">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Age:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Gender:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Vote Share:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Rank:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Constituency:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">State:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Type:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Turnout:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Margin:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Female Turnout Edge:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Outcome area for ball results, moved below the play area -->
                    <div id="outcome-area" class="outcome-area hidden">
                        <div class="outcome-title">Ball Outcome</div>
                        <div id="outcome-message" class="outcome-message">4 RUNS!</div>
                        <button id="next-ball-btn" class="next-ball-btn">Next Ball</button>
                    </div>
                    
                    <div class="result-highlight" id="result-display"></div>
                    
                    <div class="action-area">
                        <div class="card-selection">
                            <div>
                                <h3 id="action-text" style="text-align: center; margin-bottom: 15px;">Please wait for the bowler's card</h3>
                                <div class="player-cards" id="player-cards"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="game-log">
                    <div class="log-title">Match Commentary</div>
                    <div id="log-entries"></div>
                </div>
                
                <!-- Final scoreboard that will appear at the end of the game -->
                <div id="final-scoreboard" class="final-scoreboard hidden">
                    <div class="final-score-title">Final Scorecard</div>
                    <div class="final-score-row">
                        <span class="final-score-label">Your Score:</span>
                        <span id="final-user-score">0/0 (0.0)</span>
                    </div>
                    <div class="final-score-row">
                        <span class="final-score-label">Computer Score:</span>
                        <span id="final-comp-score">0/0 (0.0)</span>
                    </div>
                    <div class="final-score-row">
                        <span class="final-score-label">Result:</span>
                        <span id="final-result">-</span>
                    </div>
                </div>
            </div>
        </div>

    <script>
        // Game state variables
        let cards = [];
        let deck = [];
        let playerCards = [];
        let computerCards = [];
        let userIsBatting = false;
        let userIsBowling = false;
        let currentInnings = 1;
        let userRuns = 0;
        let userWickets = 0;
        let compRuns = 0;
        let compWickets = 0;
        let balls = 0;
        let target = null;
        let bowlerCardPlayed = null;
        let batterCardPlayed = null;
        let gameOver = false;
        let lastBallOutcome = null;
        let lastBallRuns = 0;
        let lastBallWicket = false;
        let lastBallDetails = "";
        let waitingForNextBall = false;
        
        // Constants
        const TOTAL_OVERS = 6;
        const TOTAL_WICKETS = 6;
        const BALLS_PER_OVER = 6;
        
        // DOM elements
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const batFirstBtn = document.getElementById('bat-first-btn');
        const bowlFirstBtn = document.getElementById('bowl-first-btn');
        const resetBtn = document.getElementById('reset-btn');
        const userRunsDisplay = document.getElementById('user-runs');
        const userWicketsDisplay = document.getElementById('user-wickets');
        const userOversDisplay = document.getElementById('user-overs');
        const compRunsDisplay = document.getElementById('comp-runs');
        const compWicketsDisplay = document.getElementById('comp-wickets');
        const compOversDisplay = document.getElementById('comp-overs');
        const targetRunsDisplay = document.getElementById('target-runs');
        const reqRunsDisplay = document.getElementById('req-runs');
        const currentOverDisplay = document.getElementById('current-over');
        const ballCountDisplay = document.getElementById('ball-count');
        const runRateDisplay = document.getElementById('run-rate');
        const bowlerCardDisplay = document.getElementById('bowler-card');
        const batterCardDisplay = document.getElementById('batter-card');
        const playerCardsDisplay = document.getElementById('player-cards');
        const actionTextDisplay = document.getElementById('action-text');
        const logEntriesDisplay = document.getElementById('log-entries');
        const userInningsIndicator = document.getElementById('user-innings-indicator');
        const compInningsIndicator = document.getElementById('comp-innings-indicator');
        const resultDisplay = document.getElementById('result-display');
        const ballResultDisplay = document.getElementById('ball-result-display');
        const ballResult = document.getElementById('ball-result');
        const outcomeArea = document.getElementById('outcome-area');
        const outcomeMessage = document.getElementById('outcome-message');
        const nextBallBtn = document.getElementById('next-ball-btn');
        const finalUserScore = document.getElementById('final-user-score');
        const finalCompScore = document.getElementById('final-comp-score');
        const finalResult = document.getElementById('final-result');
        const finalScoreboard = document.getElementById('final-scoreboard');
        
        // New DOM elements for separate ball outcome and innings summary
        const ballOutcomeDisplay = document.getElementById('ball-outcome-display');
        const ballOutcomeResult = document.getElementById('ball-outcome-result');
        const ballOutcomeDetails = document.getElementById('ball-outcome-details');
        const inningsSummaryDisplay = document.getElementById('innings-summary-display');
        const inningsSummaryContent = document.getElementById('innings-summary-content');
        
        // Event listeners
        batFirstBtn.addEventListener('click', () => startGame(true));
        bowlFirstBtn.addEventListener('click', () => startGame(false));
        resetBtn.addEventListener('click', resetGame);
        nextBallBtn.addEventListener('click', prepareNextBall);
        
        // Initialize the game
        async function initGame() {
            try {
                // Load cards from cards.json
                const response = await fetch('cards.json');
                const cardsData = await response.json();
                cards = Object.values(cardsData);
                console.log(`Loaded ${cards.length} cards`);
            } catch (error) {
                console.error('Error loading cards:', error);
                
                // For testing/demo purposes, create some sample cards
                cards = [];
                for (let i = 1; i <= 100; i++) {
                    cards.push({
                        id: i,
                        name: `Candidate ${i}`,
                        photo: `/api/placeholder/400/180?text=Candidate${i}`,
                        age: Math.floor(Math.random() * 40) + 30,
                        gender: Math.random() > 0.5 ? 'MALE' : 'FEMALE',
                        party: ['BJP', 'INC', 'AAP', 'YSRCP', 'DMK', 'TMC'][Math.floor(Math.random() * 6)],
                        vote_share: Math.floor(Math.random() * 50) + 20,
                        rank: Math.floor(Math.random() * 3) + 1,
                        constituency: `Constituency ${i}`,
                        state: ['Karnataka', 'Maharashtra', 'Tamil Nadu', 'Uttar Pradesh', 'West Bengal'][Math.floor(Math.random() * 5)],
                        type: ['GEN', 'SC', 'ST', 'OBC'][Math.floor(Math.random() * 4)],
                        turnout: Math.floor(Math.random() * 30) + 60,
                        margin: Math.floor(Math.random() * 25) + 1,
                        female_turnout_edge: parseFloat((Math.random() * 5 - 2.5).toFixed(2))
                    });
                }
            }
            
            // Once cards are loaded, initialize the deck count display
            updateDisplays();
        }
        
        // Start the game
        function startGame(userBatsFirst) {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            // Hide the final scoreboard if it was visible
            finalScoreboard.classList.add('hidden');
            
            // Set game mode
            userIsBatting = userBatsFirst;
            userIsBowling = !userBatsFirst;
            
            // Show current innings indicator
            if (userIsBatting) {
                userInningsIndicator.classList.remove('hidden');
                compInningsIndicator.classList.add('hidden');
            } else {
                userInningsIndicator.classList.add('hidden');
                compInningsIndicator.classList.remove('hidden');
            }
            
            // Shuffle deck and deal cards
            shuffleDeck();
            dealCards();
            
            // Set initial game state
            updateDisplays();
            
            // Set action text based on who's batting/bowling
            setActionText();
            
            // The bowler always plays first for each ball
            if (userIsBowling) {
                // If user is bowling first, wait for user to select a bowling card
                actionTextDisplay.textContent = 'Your turn to bowl! Select a card';
            } else {
                // If computer is bowling first, computer plays a bowling card
                computerPlaysBowlingCard();
            }
            
            // Log game start
            addLogEntry(`<span class="log-highlight">Game started!</span> ${userBatsFirst ? 'You' : 'Computer'} is batting first.`);
        }
        
        // Shuffle the deck of cards
        function shuffleDeck() {
            deck = [...cards];
            
            // Fisher-Yates shuffle algorithm
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        // Deal cards to players
        function dealCards() {
            playerCards = deck.splice(0, 6);
            computerCards = deck.splice(0, 6);
            renderPlayerCards();
        }
        
        // Render player's cards
        function renderPlayerCards() {
            playerCardsDisplay.innerHTML = '';
            
            playerCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'player-card';
                cardElement.dataset.index = index;
                
                cardElement.innerHTML = `
                    <div class="mini-card-header">${card.name}</div>
                    <img src="${card.photo}" alt="${card.name}" class="mini-player-image">
                    <div class="mini-card-body">
                        <div class="mini-card-info">
                            <span class="mini-info-label">Party:</span>
                            <span>${card.party}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Vote Share:</span>
                            <span>${card.vote_share}%</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Rank:</span>
                            <span>${card.rank}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Age:</span>
                            <span>${card.age}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Gender:</span>
                            <span>${card.gender}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Type:</span>
                            <span>${card.type}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Constituency:</span>
                            <span title="${card.constituency}">${card.constituency.length > 12 ? card.constituency.substring(0, 10) + '...' : card.constituency}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">State:</span>
                            <span title="${card.state}">${card.state.length > 12 ? card.state.substring(0, 10) + '...' : card.state}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Turnout:</span>
                            <span>${card.turnout}%</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Margin:</span>
                            <span>${card.margin}%</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Female Turnout Edge:</span>
                            <span>${card.female_turnout_edge}%</span>
                        </div>
                    </div>
                `;
                
                // Only enable card selection if not waiting for next ball
                if (!waitingForNextBall) {
                    cardElement.addEventListener('click', () => playerSelectsCard(index));
                }
                
                playerCardsDisplay.appendChild(cardElement);
            });
        }
        
        // Player selects a card
        function playerSelectsCard(index) {
            if (gameOver || (waitingForNextBall && !isCardRefreshTime)) return;
            
            // Check if we're in card refresh mode
            if (isCardRefreshTime) {
                discardAndDrawCard(index);
                return;
            }
            
            // If player is bowling and bowler card not played yet
            if (userIsBowling && !bowlerCardPlayed) {
                bowlerCardPlayed = playerCards[index];
                displayCard(bowlerCardPlayed, bowlerCardDisplay);
                
                // Remove the card from player's hand
                playerCards.splice(index, 1);
                
                // Draw a new card
                if (deck.length > 0) {
                    playerCards.push(deck.shift());
                }
                
                // Re-render player cards
                renderPlayerCards();
                
                // Computer plays batting card
                computerPlaysBattingCard();
                
                // Log
                addLogEntry(`You bowled with <span class="log-highlight">${bowlerCardPlayed.name}</span> (${bowlerCardPlayed.vote_share}% vote share).`);
            }
            
            // If player is batting and bowler card already played
            else if (userIsBatting && bowlerCardPlayed) {
                batterCardPlayed = playerCards[index];
                displayCard(batterCardPlayed, batterCardDisplay);
                
                // Remove the card from player's hand
                playerCards.splice(index, 1);
                
                // Draw a new card
                if (deck.length > 0) {
                    playerCards.push(deck.shift());
                }
                
                // Re-render player cards
                renderPlayerCards();
                
                // Process the ball
                processBall();
                
                // Log
                addLogEntry(`You batted with <span class="log-highlight">${batterCardPlayed.name}</span> (${batterCardPlayed.vote_share}% vote share).`);
            }
            
            // Update displays
            updateDisplays();
        }
        
        // Computer plays a bowling card
        function computerPlaysBowlingCard() {
            if (gameOver || waitingForNextBall) return;
            
            // Strategy: pick a card with high vote_share for bowling
            let bestIndex = 0;
            let highestScore = -1;
            
            for (let i = 0; i < computerCards.length; i++) {
                const card = computerCards[i];
                let score = card.vote_share;
                
                // Bonus for special cards
                if (card.gender === "FEMALE") score += 5; // Bonus for gender advantage
                if (card.type === "SC" || card.type === "ST") score += 5; // Bonus for type advantage
                
                // Pick the card with highest score
                if (score > highestScore) {
                    highestScore = score;
                    bestIndex = i;
                }
            }
            
            // Use the best card for bowling
            bowlerCardPlayed = computerCards[bestIndex];
            
            // Display the card
            displayCard(bowlerCardPlayed, bowlerCardDisplay);
            
            // Remove the card from computer's hand
            computerCards.splice(bestIndex, 1);
            
            // Draw a new card
            if (deck.length > 0) {
                computerCards.push(deck.shift());
            }
            
            // Update action text
            actionTextDisplay.textContent = "Your turn to bat! Select a card";
            
            // Log
            addLogEntry(`Computer bowled with <span class="log-highlight">${bowlerCardPlayed.name}</span> (${bowlerCardPlayed.vote_share}% vote share).`);
            
            // Update displays
            updateDisplays();
        }
        
        // Computer plays a batting card
        function computerPlaysBattingCard() {
            if (gameOver || waitingForNextBall) return;
            
            // Strategy: if vote share is below bowler's, try to find a Rank 1 card
            // Otherwise find highest vote share difference
            
            let bestIndex = 0;
            let bestScore = -Infinity;
            
            for (let i = 0; i < computerCards.length; i++) {
                const card = computerCards[i];
                let score = 0;
                
                // If vote share is below bowler's but rank is 1, it's a good choice
                if (card.vote_share < bowlerCardPlayed.vote_share && card.rank === 1) {
                    score = 100; // Very high score for rank 1 cards when needed
                } else {
                    // Otherwise score based on vote share difference
                    score = card.vote_share - bowlerCardPlayed.vote_share;
                    
                    // Special case matching
                    if (card.party === bowlerCardPlayed.party) {
                        score -= 20; // Bad choice if same party
                    }
                    if (bowlerCardPlayed.gender === "FEMALE" && card.gender !== "FEMALE") {
                        score -= 20; // Bad choice if gender disadvantage
                    }
                    if (bowlerCardPlayed.type === "SC" && card.type !== "SC") {
                        score -= 20; // Bad choice if type disadvantage
                    }
                    if (bowlerCardPlayed.type === "ST" && card.type !== "ST") {
                        score -= 20; // Bad choice if type disadvantage
                    }
                }
                
                if (score > bestScore) {
                    bestScore = score;
                    bestIndex = i;
                }
            }
            
            // Use the best card for batting
            batterCardPlayed = computerCards[bestIndex];
            
            // Display the card
            displayCard(batterCardPlayed, batterCardDisplay);
            
            // Remove the card from computer's hand
            computerCards.splice(bestIndex, 1);
            
            // Draw a new card
            if (deck.length > 0) {
                computerCards.push(deck.shift());
            }
            
            // Process the ball
            processBall();
            
            // Log
            addLogEntry(`Computer batted with <span class="log-highlight">${batterCardPlayed.name}</span> (${batterCardPlayed.vote_share}% vote share).`);
            
            // Update displays
            updateDisplays();
        }
        
        // Display a card in the card display area
        function displayCard(card, displayElement) {
            displayElement.innerHTML = `
                <div class="card-header">${card.name}</div>
                <img src="${card.photo}" alt="${card.name}" class="player-image">
                <div class="card-body">
                    <div class="card-info">
                        <span class="info-label">Party:</span>
                        <span class="info-value party-tag">${card.party}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Age:</span>
                        <span class="info-value">${card.age}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Gender:</span>
                        <span class="info-value">${card.gender}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Vote Share:</span>
                        <span class="info-value">${card.vote_share}%</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Rank:</span>
                        <span class="info-value">${card.rank}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Constituency:</span>
                        <span class="info-value">${card.constituency}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">State:</span>
                        <span class="info-value">${card.state}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Type:</span>
                        <span class="info-value">${card.type}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Turnout:</span>
                        <span class="info-value">${card.turnout}%</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Margin:</span>
                        <span class="info-value">${card.margin}%</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Female Turnout Edge:</span>
                        <span class="info-value">${card.female_turnout_edge}%</span>
                    </div>
                </div>
            `;
        }
        
        // Process the ball (determine outcome)
        function processBall() {
            balls++;
            let runsScored = 0;
            let isWicket = false;
            let outcomeDescription = "";
            
            // First check for wicket
            // Logic: If batter's vote_share < bowler's vote_share, it's a wicket
            // EXCEPTION: Rank 1 batters can never get out irrespective of vote_share
            if (batterCardPlayed.vote_share < bowlerCardPlayed.vote_share && batterCardPlayed.rank !== 1) {
                isWicket = true;
                outcomeDescription = `${batterCardPlayed.name}'s vote share (${batterCardPlayed.vote_share}%) is lower than ${bowlerCardPlayed.name}'s (${bowlerCardPlayed.vote_share}%).`;
            } else {
                // If no wicket, calculate runs based on the new rules
                
                // Special cases first:
                let specialCaseApplied = false;
                
                // 1. If both cards belong to the same party, compute 0 runs
                if (batterCardPlayed.party === bowlerCardPlayed.party) {
                    runsScored = 0;
                    outcomeDescription = `Both players belong to ${batterCardPlayed.party} party. No runs scored.`;
                    specialCaseApplied = true;
                }
                // 2. For FEMALE bowlers, non-FEMALE batters get 0 runs
                else if (bowlerCardPlayed.gender === "FEMALE" && batterCardPlayed.gender !== "FEMALE") {
                    runsScored = 0;
                    outcomeDescription = `${bowlerCardPlayed.name} (FEMALE) bowled to ${batterCardPlayed.name} (${batterCardPlayed.gender}). Gender advantage - no runs scored.`;
                    specialCaseApplied = true;
                }
                // 3. For SC bowlers, non-SC batters get 0 runs
                else if (bowlerCardPlayed.type === "SC" && batterCardPlayed.type !== "SC") {
                    runsScored = 0;
                    outcomeDescription = `${bowlerCardPlayed.name} (SC) bowled to ${batterCardPlayed.name} (${batterCardPlayed.type}). Caste advantage - no runs scored.`;
                    specialCaseApplied = true;
                }
                // 4. For ST bowlers, non-ST batters get 0 runs
                else if (bowlerCardPlayed.type === "ST" && batterCardPlayed.type !== "ST") {
                    runsScored = 0;
                    outcomeDescription = `${bowlerCardPlayed.name} (ST) bowled to ${batterCardPlayed.name} (${batterCardPlayed.type}). Tribal advantage - no runs scored.`;
                    specialCaseApplied = true;
                }
                // Otherwise, calculate runs based on the vote_share difference
                else {
                    // Calculate the difference
                    const difference = batterCardPlayed.vote_share - bowlerCardPlayed.vote_share;
                    
                    // Assign runs based on the difference ranges
                    if (difference >= 0 && difference < 3) {
                        runsScored = 0;
                        outcomeDescription = `Vote share difference (${difference.toFixed(1)}%) is below 3%. No runs scored.`;
                    } else if (difference >= 3 && difference < 6) {
                        runsScored = 1;
                        outcomeDescription = `Vote share difference (${difference.toFixed(1)}%) is between 3-6%. 1 run scored.`;
                    } else if (difference >= 6 && difference < 9) {
                        runsScored = 2;
                        outcomeDescription = `Vote share difference (${difference.toFixed(1)}%) is between 6-9%. 2 runs scored.`;
                    } else if (difference >= 9 && difference < 12) {
                        runsScored = 3;
                        outcomeDescription = `Vote share difference (${difference.toFixed(1)}%) is between 9-12%. 3 runs scored.`;
                    } else if (difference >= 12 && difference < 15) {
                        runsScored = 4;
                        outcomeDescription = `Vote share difference (${difference.toFixed(1)}%) is between 12-15%. 4 runs scored.`;
                    } else if (difference >= 15) {
                        runsScored = 6;
                        outcomeDescription = `Vote share difference (${difference.toFixed(1)}%) is 15% or more. 6 runs scored!`;
                    }
                }
                
                // Check if Rank 1 batter would have been out but was saved
                if (batterCardPlayed.rank === 1 && batterCardPlayed.vote_share < bowlerCardPlayed.vote_share) {
                    outcomeDescription = `${batterCardPlayed.name} is a Rank 1 candidate and can't be dismissed despite lower vote share! ` + outcomeDescription;
                }
            }
            
            // Store the outcome for next ball button
            lastBallOutcome = isWicket ? "WICKET!" : `${runsScored} RUN${runsScored !== 1 ? 'S' : ''}!`;
            lastBallRuns = runsScored;
            lastBallWicket = isWicket;
            lastBallDetails = outcomeDescription;
            
            // Set waiting for next ball
            waitingForNextBall = true;
            
            // Update scores
            if (userIsBatting) {
                if (isWicket) {
                    userWickets++;
                } else {
                    userRuns += runsScored;
                }
            } else {
                if (isWicket) {
                    compWickets++;
                } else {
                    compRuns += runsScored;
                }
            }
            
            // Store the current innings data to preserve it for scorecards
            if (currentInnings === 1) {
                if (userIsBatting) {
                    // Save user's batting stats in first innings
                    window.firstInningsData = {
                        team: "user",
                        runs: userRuns,
                        wickets: userWickets,
                        overs: `${Math.floor(balls / BALLS_PER_OVER)}.${balls % BALLS_PER_OVER}`
                    };
                } else {
                    // Save computer's batting stats in first innings
                    window.firstInningsData = {
                        team: "comp",
                        runs: compRuns,
                        wickets: compWickets,
                        overs: `${Math.floor(balls / BALLS_PER_OVER)}.${balls % BALLS_PER_OVER}`
                    };
                }
            }
            
            // Show ball outcome in separate display
            ballOutcomeResult.textContent = lastBallOutcome;
            ballOutcomeResult.className = isWicket ? 'ball-outcome-result wicket' : 'ball-outcome-result runs';
            ballOutcomeDetails.textContent = outcomeDescription;
            ballOutcomeDisplay.classList.remove('hidden');
            
            // Show outcome area with action button
            outcomeMessage.innerHTML = `
                <div class="refresh-info">${lastBallOutcome}</div>
                <p>${outcomeDescription}</p>
                <p>${isWicket ? (userIsBatting ? 'You' : 'Computer') + ' lost a wicket!' : 
                   (runsScored === 0 ? 'Dot ball!' : (userIsBatting ? 'You' : 'Computer') + ' scored ' + runsScored + ' run' + (runsScored !== 1 ? 's' : '') + '!')}</p>
            `;
            outcomeArea.classList.remove('hidden');
            
            // Log the result with more details
            if (isWicket) {
                addLogEntry(`<span class="log-highlight">WICKET!</span> ${userIsBatting ? 'You' : 'Computer'} lost a wicket. ${outcomeDescription}`);
            } else {
                addLogEntry(`<span class="log-highlight">${runsScored} run${runsScored !== 1 ? 's' : ''}</span> scored by ${userIsBatting ? 'you' : 'computer'}. ${outcomeDescription}`);
            }
            
            // Update displays
            updateDisplays();
            
            // Check if over is complete
            if (balls % BALLS_PER_OVER === 0) {
                const currentOver = Math.floor(balls / BALLS_PER_OVER);
                addLogEntry(`<span class="log-highlight">End of over ${currentOver}</span>`);
                
                // At the end of each but the last over, bowler can refresh cards
                if (currentOver < TOTAL_OVERS - 1) {
                    // Determine who is bowling in the current innings
                    const userIsBowlingNow = (userIsBatting === false);
                    
                    // After showing outcome, we'll show the card refresh option
                    outcomeMessage.innerHTML += `
                        <p style="margin-top: 15px;"><strong>End of over ${currentOver}.</strong></p>
                        <p>${userIsBowlingNow ? 'You' : 'Computer'} can refresh cards twice.</p>
                    `;
                    
                    // Change next ball button text
                    nextBallBtn.textContent = "Manage Cards";
                }
            }
            
            // Check if last wicket just fell or all overs are complete
            const oversCompleted = Math.floor(balls / BALLS_PER_OVER);
            const ballsInCurrentOver = balls % BALLS_PER_OVER;
            const currentWickets = userIsBatting ? userWickets : compWickets;
            const currentTeam = userIsBatting ? "Your" : "Computer's";
            
            const inningsOver = oversCompleted >= TOTAL_OVERS || currentWickets >= TOTAL_WICKETS;
            
            if (inningsOver) {
                const currentRuns = userIsBatting ? userRuns : compRuns;
                const oversText = `${oversCompleted}.${ballsInCurrentOver}`;
                
                // Display innings summary while still showing the last ball outcome
                let inningsSummaryHTML = '';
                
                if (isWicket && currentWickets >= TOTAL_WICKETS) {
                    // Wicket just fell that ends the innings
                    inningsSummaryHTML = `
                        <p><strong>${currentTeam} team is all out!</strong></p>
                        <p>Final Score: ${currentRuns}/${currentWickets} in ${oversText} overs.</p>
                    `;
                } else if (oversCompleted >= TOTAL_OVERS) {
                    // All overs completed
                    inningsSummaryHTML = `
                        <p><strong>${currentTeam} innings is over! All overs completed.</strong></p>
                        <p>Final Score: ${currentRuns}/${currentWickets} in ${oversText} overs.</p>
                    `;
                }
                
                // In second innings, check if the game is over
                if (currentInnings === 2) {
                    const targetAchieved = (userIsBatting && userRuns >= target) || (!userIsBatting && compRuns >= target);
                    
                    if (!targetAchieved) {
                        // Team failed to chase the target
                        const defendingTeam = userIsBatting ? "Computer" : "You";
                        const winningRuns = target - (userIsBatting ? userRuns : compRuns) - 1;
                        
                        inningsSummaryHTML += `
                            <p><strong>${defendingTeam} won by ${winningRuns} runs!</strong></p>
                        `;
                    }
                }
                
                // Show innings summary
                inningsSummaryContent.innerHTML = inningsSummaryHTML;
                inningsSummaryDisplay.classList.remove('hidden');
            }
            
            // Check if target has been achieved in second innings
            if (currentInnings === 2) {
                const currentRuns = userIsBatting ? userRuns : compRuns;
                const targetAchieved = currentRuns >= target;
                
                if (targetAchieved) {
                    const winningTeam = userIsBatting ? "You" : "Computer";
                    const remainingWickets = TOTAL_WICKETS - currentWickets;
                    const remainingBalls = (TOTAL_OVERS * BALLS_PER_OVER) - balls;
                    const oversText = `${oversCompleted}.${ballsInCurrentOver}`;
                    
                    // Display innings summary
                    const inningsSummaryHTML = `
                        <p><strong>${winningTeam} won by ${remainingWickets} wicket${remainingWickets !== 1 ? 's' : ''}!</strong></p>
                        <p>Final Score: ${currentRuns}/${currentWickets} in ${oversText} overs.</p>
                        <p>Target of ${target} runs achieved with ${remainingBalls} ball${remainingBalls !== 1 ? 's' : ''} remaining.</p>
                    `;
                    
                    inningsSummaryContent.innerHTML = inningsSummaryHTML;
                    inningsSummaryDisplay.classList.remove('hidden');
                }
            }
            
            // Check if innings/game is over (but don't proceed automatically)
            checkInningsStatus();
        }
        
        // Variable to track card refresh opportunities for the bowler
        let cardRefreshCount = 0;
        let isCardRefreshTime = false;
        
        // Prepare for the next ball
        function prepareNextBall() {
            if (gameOver) return;
            
            // Check if it's card refresh time (end of over but not last over)
            const currentOver = Math.floor(balls / BALLS_PER_OVER);
            
            // If we just finished an over (but not the last one) and we haven't used all refresh opportunities
            if (balls % BALLS_PER_OVER === 0 && currentOver < TOTAL_OVERS - 1 && cardRefreshCount < 2) {
                // If button text is "Manage Cards" or we're already in refresh mode
                if (nextBallBtn.textContent === "Manage Cards" || isCardRefreshTime) {
                    isCardRefreshTime = true;
                    
                    // Determine who is bowling in the current innings
                    const userIsBowlingNow = (userIsBatting === false);
                    
                    if (userIsBowlingNow) {
                        // User is bowling, show card refresh interface
                        showCardRefreshInterface();
                        return;
                    } else {
                        // Computer is bowling, it will automatically refresh cards
                        computerRefreshCards();
                        cardRefreshCount++;
                        
                        if (cardRefreshCount < 2) {
                            // Still has one more refresh
                            outcomeMessage.innerHTML = `
                                <div class="refresh-info">Computer's Card Refresh (${cardRefreshCount}/2)</div>
                                <p>Computer has refreshed one card.</p>
                                <p>Click Continue to see next refresh.</p>
                            `;
                            nextBallBtn.textContent = "Continue";
                            return;
                        } else {
                            // Used all refreshes, proceed to next over
                            outcomeMessage.innerHTML = `
                                <div class="refresh-info">Computer's Card Refresh Complete</div>
                                <p>Computer has refreshed cards twice.</p>
                                <p>Ready for the next over!</p>
                            `;
                            nextBallBtn.textContent = "Start Next Over";
                            cardRefreshCount = 0;
                            isCardRefreshTime = false;
                            return;
                        }
                    }
                } else if (nextBallBtn.textContent === "Continue") {
                    // Second computer refresh
                    computerRefreshCards();
                    cardRefreshCount = 0;
                    isCardRefreshTime = false;
                    outcomeMessage.innerHTML = `
                        <div class="refresh-info">Computer's Card Refresh Complete</div>
                        <p>Computer has refreshed cards twice.</p>
                        <p>Ready for the next over!</p>
                    `;
                    nextBallBtn.textContent = "Start Next Over";
                    return;
                } else if (nextBallBtn.textContent === "Start Next Over") {
                    // Reset card refresh state
                    cardRefreshCount = 0;
                    isCardRefreshTime = false;
                }
