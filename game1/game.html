<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Card Game - Lok Sabha Elections 2024</title>
    <style>
        :root {
            --primary-color: #f47216;
            --secondary-color: #2b5797;
            --accent-color: #00a550;
            --light-bg: #f5f5f5;
            --dark-bg: #333;
            --text-color: #333;
            --light-text: #fff;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.2);
            --border-radius: 10px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        
        header h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .game-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        button {
            background-color: var(--secondary-color);
            color: var(--light-text);
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #1e3c6b;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .reset-btn {
            background-color: #d9534f;
        }
        
        .reset-btn:hover {
            background-color: #c9302c;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .scoreboard {
            background-color: var(--secondary-color);
            color: var(--light-text);
            padding: 20px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .score-section {
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        
        .scoreboard h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .score-detail {
            font-size: 1.2rem;
            margin: 5px 0;
        }
        
        .current-innings {
            font-weight: bold;
            background-color: var(--accent-color);
            color: var(--light-text);
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .match-stats {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            text-align: center;
            min-width: 120px;
        }
        
        .stat-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--secondary-color);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .board {
            display: flex;
            flex-direction: column;
            gap: 40px;
        }
        
        .play-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .card-played {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .card-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .card {
            position: relative;
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
            height: auto;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .card-body {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            max-height: 350px;
        }
        
        .card-info {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .info-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .info-value {
            text-align: right;
        }
        
        .party-tag {
            background-color: var(--secondary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .action-area {
            margin-top: 30px;
        }
        
        .card-selection {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .player-cards {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .player-card {
            width: 180px;
            height: 280px;
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .player-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        /* Discard mode styles */
        .discard-mode {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .discard-mode:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 16px rgba(255,0,0,0.3);
            opacity: 0.9;
        }
        
        .discard-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(220, 53, 69, 0.7);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        
        .discard-mode:hover .discard-overlay {
            opacity: 1;
        }
        
        .mini-card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 5px;
            text-align: center;
            font-size: 0.75rem;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mini-player-image {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }
        
        .mini-card-body {
            padding: 8px;
            font-size: 0.75rem;
            flex: 1;
            overflow-y: auto;
        }
        
        .mini-card-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .mini-info-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .mini-card-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        
        .mini-info-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .game-log {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            box-shadow: var(--card-shadow);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
            text-align: center;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .log-highlight {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .hidden {
            display: none;
        }
        
        .game-over-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .modal-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .modal-message {
            font-size: 1.2rem;
            margin-bottom: 25px;
        }
        
        .modal-button {
            background-color: var(--accent-color);
            padding: 12px 30px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                height: auto;
                min-height: 450px;
            }
            
            .player-card {
                width: 150px;
                height: 300px;
                font-size: 0.7rem;
            }
            
            .mini-card-body {
                font-size: 0.7rem;
            }
            
            .play-area {
                gap: 15px;
            }
        }

        .result-highlight {
            font-size: 1.5rem;
            color: var(--accent-color);
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .ball-result {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .wicket {
            color: #d9534f;
        }

        .runs {
            color: var(--accent-color);
        }
        
        /* New styles for outcome area and next ball button */
        .outcome-area {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px auto;
            box-shadow: var(--card-shadow);
            text-align: center;
            max-width: 600px;
        }
        
        .outcome-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .outcome-message {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .next-ball-btn {
            background-color: var(--accent-color);
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .next-ball-btn:hover {
            background-color: #008c45;
        }
        
        .final-scoreboard {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
        }
        
        .final-score-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--secondary-color);
            text-align: center;
        }
        
        .final-score-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .final-score-label {
            font-weight: bold;
            color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cricket Card Game - Lok Sabha Elections 2024</h1>
            <p>Use election candidate cards to play cricket!</p>
        </header>
        
        <div id="start-screen">
            <h2 style="text-align: center; margin-bottom: 20px;">Choose Your Strategy</h2>
            <div class="game-options">
                <button id="bat-first-btn">Bat First</button>
                <button id="bowl-first-btn">Bowl First</button>
            </div>
        </div>
        
        <div id="game-screen" class="hidden">
            <div class="game-options">
                <button id="reset-btn" class="reset-btn">Reset Game</button>
            </div>
            
            <div class="game-area">
                <div class="scoreboard">
                    <div class="score-section">
                        <h2>Your Score</h2>
                        <p class="score-detail">Runs: <span id="user-runs">0</span>/<span id="user-wickets">0</span></p>
                        <p class="score-detail">Overs: <span id="user-overs">0.0</span></p>
                        <p id="user-innings-indicator" class="current-innings hidden">Batting Now</p>
                    </div>
                    <div class="score-section">
                        <h2>Target</h2>
                        <p class="score-detail"><span id="target-runs">-</span></p>
                    </div>
                    <div class="score-section">
                        <h2>Computer Score</h2>
                        <p class="score-detail">Runs: <span id="comp-runs">0</span>/<span id="comp-wickets">0</span></p>
                        <p class="score-detail">Overs: <span id="comp-overs">0.0</span></p>
                        <p id="comp-innings-indicator" class="current-innings hidden">Batting Now</p>
                    </div>
                </div>
                
                <div class="match-stats">
                    <div class="stat-box">
                        <div class="stat-title">Over</div>
                        <div id="current-over" class="stat-value">0.0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">Ball</div>
                        <div id="ball-count" class="stat-value">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">Required</div>
                        <div id="req-runs" class="stat-value">-</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-title">Run Rate</div>
                        <div id="run-rate" class="stat-value">0.00</div>
                    </div>
                </div>
                
                <div id="ball-result-display" class="hidden">
                    <div id="ball-result" class="ball-result">4 RUNS!</div>
                </div>
                
                <div class="board">
                    <div class="play-area">
                        <div class="card-played">
                            <div class="card-title">Bowler's Card</div>
                            <div id="bowler-card" class="card">
                                <div class="card-header">Select a card to start</div>
                                <img src="/api/placeholder/400/180" alt="Candidate Photo" class="player-image">
                                <div class="card-body">
                                    <div class="card-info">
                                        <span class="info-label">Party:</span>
                                        <span class="info-value party-tag">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Age:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Gender:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Vote Share:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Rank:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Constituency:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">State:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Type:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Turnout:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Margin:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Female Turnout Edge:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-played">
                            <div class="card-title">Batter's Card</div>
                            <div id="batter-card" class="card">
                                <div class="card-header">Select a card to start</div>
                                <img src="/api/placeholder/400/180" alt="Candidate Photo" class="player-image">
                                <div class="card-body">
                                    <div class="card-info">
                                        <span class="info-label">Party:</span>
                                        <span class="info-value party-tag">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Age:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Gender:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Vote Share:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Rank:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Constituency:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">State:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Type:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Turnout:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Margin:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                    <div class="card-info">
                                        <span class="info-label">Female Turnout Edge:</span>
                                        <span class="info-value">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- New outcome area for ball results -->
                    <div id="outcome-area" class="outcome-area hidden">
                        <div class="outcome-title">Ball Outcome</div>
                        <div id="outcome-message" class="outcome-message">4 RUNS!</div>
                        <button id="next-ball-btn" class="next-ball-btn">Next Ball</button>
                    </div>
                    
                    <!-- New discard area for end of over -->
                    <div id="discard-area" class="outcome-area hidden">
                        <div class="outcome-title">End of Over</div>
                        <div id="discard-instructions" class="outcome-message">You can discard and draw up to 2 cards.</div>
                        <div id="discard-counter" class="ball-result">0/2 discards used</div>
                        <button id="finish-discard-btn" class="next-ball-btn">Finish</button>
                    </div>
                    
                    <div class="result-highlight" id="result-display"></div>
                    
                    <div class="action-area">
                        <div class="card-selection">
                            <div>
                                <h3 id="action-text" style="text-align: center; margin-bottom: 15px;">Please wait for the bowler's card</h3>
                                <div class="player-cards" id="player-cards"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="game-log">
                    <div class="log-title">Match Commentary</div>
                    <div id="log-entries"></div>
                </div>
            </div>
        </div>
        
        <div id="game-over-modal" class="game-over-modal">
            <div class="modal-content">
                <h2 class="modal-title">Game Over!</h2>
                <p id="modal-message" class="modal-message">The match has ended.</p>
                
                <!-- Added final scoreboard in the game over modal -->
                <div class="final-scoreboard">
                    <div class="final-score-title">Final Scorecard</div>
                    <div class="final-score-row">
                        <span class="final-score-label">Your Score:</span>
                        <span id="final-user-score">0/0 (0.0)</span>
                    </div>
                    <div class="final-score-row">
                        <span class="final-score-label">Computer Score:</span>
                        <span id="final-comp-score">0/0 (0.0)</span>
                    </div>
                    <div class="final-score-row">
                        <span class="final-score-label">Result:</span>
                        <span id="final-result">-</span>
                    </div>
                </div>
                
                <button id="play-again-btn" class="modal-button">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Game state variables
        let cards = [];
        let deck = [];
        let playerCards = [];
        let computerCards = [];
        let userIsBatting = false;
        let userIsBowling = false;
        let currentInnings = 1;
        let userRuns = 0;
        let userWickets = 0;
        let compRuns = 0;
        let compWickets = 0;
        let balls = 0;
        let target = null;
        let bowlerCardPlayed = null;
        let batterCardPlayed = null;
        let gameOver = false;
        let lastBallOutcome = null;
        let lastBallRuns = 0;
        let lastBallWicket = false;
        let waitingForNextBall = false;
        let discardMode = false;
        let discardCount = 0;
        
        // Constants
        const TOTAL_OVERS = 6;
        const TOTAL_WICKETS = 6;
        const BALLS_PER_OVER = 6;
        
        // DOM elements
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const batFirstBtn = document.getElementById('bat-first-btn');
        const bowlFirstBtn = document.getElementById('bowl-first-btn');
        const resetBtn = document.getElementById('reset-btn');
        const userRunsDisplay = document.getElementById('user-runs');
        const userWicketsDisplay = document.getElementById('user-wickets');
        const userOversDisplay = document.getElementById('user-overs');
        const compRunsDisplay = document.getElementById('comp-runs');
        const compWicketsDisplay = document.getElementById('comp-wickets');
        const compOversDisplay = document.getElementById('comp-overs');
        const targetRunsDisplay = document.getElementById('target-runs');
        const reqRunsDisplay = document.getElementById('req-runs');
        const currentOverDisplay = document.getElementById('current-over');
        const ballCountDisplay = document.getElementById('ball-count');
        const runRateDisplay = document.getElementById('run-rate');
        const bowlerCardDisplay = document.getElementById('bowler-card');
        const batterCardDisplay = document.getElementById('batter-card');
        const playerCardsDisplay = document.getElementById('player-cards');
        const actionTextDisplay = document.getElementById('action-text');
        const logEntriesDisplay = document.getElementById('log-entries');
        const userInningsIndicator = document.getElementById('user-innings-indicator');
        const compInningsIndicator = document.getElementById('comp-innings-indicator');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalMessage = document.getElementById('modal-message');
        const playAgainBtn = document.getElementById('play-again-btn');
        const resultDisplay = document.getElementById('result-display');
        const ballResultDisplay = document.getElementById('ball-result-display');
        const ballResult = document.getElementById('ball-result');
        const outcomeArea = document.getElementById('outcome-area');
        const outcomeMessage = document.getElementById('outcome-message');
        const nextBallBtn = document.getElementById('next-ball-btn');
        const finalUserScore = document.getElementById('final-user-score');
        const finalCompScore = document.getElementById('final-comp-score');
        const finalResult = document.getElementById('final-result');
        const discardArea = document.getElementById('discard-area');
        const discardInstructionsText = document.getElementById('discard-instructions');
        const discardCounterText = document.getElementById('discard-counter');
        const finishDiscardBtn = document.getElementById('finish-discard-btn');
        
        // Event listeners
        batFirstBtn.addEventListener('click', () => startGame(true));
        bowlFirstBtn.addEventListener('click', () => startGame(false));
        resetBtn.addEventListener('click', resetGame);
        playAgainBtn.addEventListener('click', resetGame);
        nextBallBtn.addEventListener('click', prepareNextBall);
        finishDiscardBtn.addEventListener('click', finishDiscardPhase);
        
        // Initialize the game
        async function initGame() {
            try {
                // Load cards from cards.json
                const response = await fetch('cards.json');
                const cardsData = await response.json();
                cards = Object.values(cardsData);
                console.log(`Loaded ${cards.length} cards`);
            } catch (error) {
                console.error('Error loading cards:', error);
                
                // For testing/demo purposes, create some sample cards
                cards = [];
                for (let i = 1; i <= 100; i++) {
                    cards.push({
                        id: i,
                        name: `Candidate ${i}`,
                        photo: `/api/placeholder/400/180?text=Candidate${i}`,
                        age: Math.floor(Math.random() * 40) + 30,
                        gender: Math.random() > 0.5 ? 'MALE' : 'FEMALE',
                        party: ['BJP', 'INC', 'AAP', 'YSRCP', 'DMK', 'TMC'][Math.floor(Math.random() * 6)],
                        vote_share: Math.floor(Math.random() * 50) + 20,
                        rank: Math.floor(Math.random() * 3) + 1,
                        constituency: `Constituency ${i}`,
                        state: ['Karnataka', 'Maharashtra', 'Tamil Nadu', 'Uttar Pradesh', 'West Bengal'][Math.floor(Math.random() * 5)],
                        type: ['GEN', 'SC', 'ST', 'OBC'][Math.floor(Math.random() * 4)],
                        turnout: Math.floor(Math.random() * 30) + 60,
                        margin: Math.floor(Math.random() * 25) + 1,
                        female_turnout_edge: parseFloat((Math.random() * 5 - 2.5).toFixed(2))
                    });
                }
                console.log(`Created ${cards.length} sample cards`);
            }
        }
        
        // Start the game
        function startGame(userBatsFirst) {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            // Set game mode
            userIsBatting = userBatsFirst;
            userIsBowling = !userBatsFirst;
            
            // Show current innings indicator
            if (userIsBatting) {
                userInningsIndicator.classList.remove('hidden');
                compInningsIndicator.classList.add('hidden');
            } else {
                userInningsIndicator.classList.add('hidden');
                compInningsIndicator.classList.remove('hidden');
            }
            
            // Shuffle deck and deal cards
            shuffleDeck();
            dealCards();
            
            // Set initial game state
            updateDisplays();
            
            // Set action text based on who's batting/bowling
            setActionText();
            
            // The bowler always plays first for each ball
            if (userIsBowling) {
                // If user is bowling first, wait for user to select a bowling card
                actionTextDisplay.textContent = 'Your turn to bowl! Select a card';
            } else {
                // If computer is bowling first, computer plays a bowling card
                setTimeout(() => computerPlaysBowlingCard(), 500);
            }
            
            // Log game start
            addLogEntry(`<span class="log-highlight">Game started!</span> ${userBatsFirst ? 'You' : 'Computer'} is batting first.`);
        }
        
        // Shuffle the deck of cards
        function shuffleDeck() {
            deck = [...cards];
            
            // Fisher-Yates shuffle algorithm
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            console.log(`Shuffled deck with ${deck.length} cards`);
        }
        
        // Deal cards to players
        function dealCards() {
            playerCards = deck.splice(0, 6);
            computerCards = deck.splice(0, 6);
            console.log(`Dealt ${playerCards.length} cards to player and ${computerCards.length} cards to computer`);
            renderPlayerCards();
        }
        
        // Render player's cards
        function renderPlayerCards() {
            console.log(`Rendering ${playerCards.length} player cards, discard mode: ${discardMode}`);
            playerCardsDisplay.innerHTML = '';
            
            playerCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'player-card';
                cardElement.dataset.index = index;
                
                // Add a discard mode style if in discard mode
                if (discardMode) {
                    cardElement.classList.add('discard-mode');
                }
                
                cardElement.innerHTML = `
                    ${discardMode ? '<div class="discard-overlay">DISCARD</div>' : ''}
                    <div class="mini-card-header">${card.name}</div>
                    <img src="${card.photo}" alt="${card.name}" class="mini-player-image">
                    <div class="mini-card-body">
                        <div class="mini-card-info">
                            <span class="mini-info-label">Party:</span>
                            <span>${card.party}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Vote Share:</span>
                            <span>${card.vote_share}%</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Rank:</span>
                            <span>${card.rank}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Age:</span>
                            <span>${card.age}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Gender:</span>
                            <span>${card.gender}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Type:</span>
                            <span>${card.type}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Constituency:</span>
                            <span title="${card.constituency}">${card.constituency.length > 12 ? card.constituency.substring(0, 10) + '...' : card.constituency}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">State:</span>
                            <span title="${card.state}">${card.state.length > 12 ? card.state.substring(0, 10) + '...' : card.state}</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Turnout:</span>
                            <span>${card.turnout}%</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Margin:</span>
                            <span>${card.margin}%</span>
                        </div>
                        <div class="mini-card-info">
                            <span class="mini-info-label">Female Turnout Edge:</span>
                            <span>${card.female_turnout_edge}%</span>
                        </div>
                    </div>
                `;
                
                if (discardMode) {
                    // In discard mode, use a different click handler
                    cardElement.addEventListener('click', () => {
                        console.log(`Card ${index} clicked in discard mode`);
                        handleCardDiscard(index);
                    });
                } else if (!waitingForNextBall) {
                    // Normal mode and not waiting for next ball
                    cardElement.addEventListener('click', () => {
                        console.log(`Card ${index} clicked in normal mode`);
                        playerSelectsCard(index);
                    });
                }
                
                playerCardsDisplay.appendChild(cardElement);
            });
        }
        
        // Player selects a card
        function playerSelectsCard(index) {
            if (gameOver || waitingForNextBall) return;
            
            // If in discard mode, handle discarding
            if (discardMode) {
                handleCardDiscard(index);
                return;
            }
            
            // If player is bowling and bowler card not played yet
            if (userIsBowling && !bowlerCardPlayed) {
                bowlerCardPlayed = playerCards[index];
                displayCard(bowlerCardPlayed, bowlerCardDisplay);
                
                // Remove the card from player's hand
                playerCards.splice(index, 1);
                
                // Draw a new card
                if (deck.length > 0) {
                    playerCards.push(deck.shift());
                }
                
                // Re-render player cards
                renderPlayerCards();
                
                // Computer plays batting card
                computerPlaysBattingCard();
                
                // Log
                addLogEntry(`You bowled with <span class="log-highlight">${bowlerCardPlayed.name}</span> (${bowlerCardPlayed.vote_share}% vote share).`);
            }
            
            // If player is batting and bowler card already played
            else if (userIsBatting && bowlerCardPlayed) {
                batterCardPlayed = playerCards[index];
                displayCard(batterCardPlayed, batterCardDisplay);
                
                // Remove the card from player's hand
                playerCards.splice(index, 1);
                
                // Draw a new card
                if (deck.length > 0) {
                    playerCards.push(deck.shift());
                }
                
                // Re-render player cards
                renderPlayerCards();
                
                // Process the ball
                processBall();
                
                // Log
                addLogEntry(`You batted with <span class="log-highlight">${batterCardPlayed.name}</span> (${batterCardPlayed.vote_share}% vote share).`);
            }
        }
        
        // Computer plays a bowling card
        function computerPlaysBowlingCard() {
            if (gameOver || waitingForNextBall) return;
            
            console.log("Computer playing bowling card");
            
            // Check if computer has cards
            if (computerCards.length === 0) {
                console.error("Computer has no cards to play!");
                return;
            }
            
            // Randomly select a card from computer's hand
            const randomIndex = Math.floor(Math.random() * computerCards.length);
            bowlerCardPlayed = computerCards[randomIndex];
            
            // Display the card
            displayCard(bowlerCardPlayed, bowlerCardDisplay);
            
            // Remove the card from computer's hand
            computerCards.splice(randomIndex, 1);
            
            // Draw a new card
            if (deck.length > 0) {
                computerCards.push(deck.shift());
            }
            
            // Update action text
            actionTextDisplay.textContent = "Your turn to bat! Select a card";
            
            // Log
            addLogEntry(`Computer bowled with <span class="log-highlight">${bowlerCardPlayed.name}</span> (${bowlerCardPlayed.vote_share}% vote share).`);
        }
        
        // Computer plays a batting card
        function computerPlaysBattingCard() {
            if (gameOver || waitingForNextBall) return;
            
            // Randomly select a card from computer's hand
            const randomIndex = Math.floor(Math.random() * computerCards.length);
            batterCardPlayed = computerCards[randomIndex];
            
            // Display the card
            displayCard(batterCardPlayed, batterCardDisplay);
            
            // Remove the card from computer's hand
            computerCards.splice(randomIndex, 1);
            
            // Draw a new card
            if (deck.length > 0) {
                computerCards.push(deck.shift());
            }
            
            // Process the ball
            processBall();
            
            // Log
            addLogEntry(`Computer batted with <span class="log-highlight">${batterCardPlayed.name}</span> (${batterCardPlayed.vote_share}% vote share).`);
        }
        
        // Display a card in the card display area
        function displayCard(card, displayElement) {
            displayElement.innerHTML = `
                <div class="card-header">${card.name}</div>
                <img src="${card.photo}" alt="${card.name}" class="player-image">
                <div class="card-body">
                    <div class="card-info">
                        <span class="info-label">Party:</span>
                        <span class="info-value party-tag">${card.party}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Age:</span>
                        <span class="info-value">${card.age}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Gender:</span>
                        <span class="info-value">${card.gender}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Vote Share:</span>
                        <span class="info-value">${card.vote_share}%</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Rank:</span>
                        <span class="info-value">${card.rank}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Constituency:</span>
                        <span class="info-value">${card.constituency}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">State:</span>
                        <span class="info-value">${card.state}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Type:</span>
                        <span class="info-value">${card.type}</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Turnout:</span>
                        <span class="info-value">${card.turnout}%</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Margin:</span>
                        <span class="info-value">${card.margin}%</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Female Turnout Edge:</span>
                        <span class="info-value">${card.female_turnout_edge}%</span>
                    </div>
                </div>
            `;
        }
        
        // Process the ball (determine outcome)
        function processBall() {
            balls++;
            let runsScored = 0;
            let isWicket = false;
            
            // First check for wicket
            // Logic: If batter's vote_share < bowler's vote_share, it's a wicket
            // EXCEPTION: Rank 1 batters can never get out irrespective of vote_share
            if (batterCardPlayed.vote_share < bowlerCardPlayed.vote_share && batterCardPlayed.rank !== 1) {
                isWicket = true;
            } else {
                // If no wicket, calculate runs based on the new rules
                
                // Special cases first:
                
                // 1. If both cards belong to the same party, compute 0 runs
                if (batterCardPlayed.party === bowlerCardPlayed.party) {
                    runsScored = 0;
                }
                // 2. For FEMALE bowlers, non-FEMALE batters get 0 runs
                else if (bowlerCardPlayed.gender === "FEMALE" && batterCardPlayed.gender !== "FEMALE") {
                    runsScored = 0;
                }
                // 3. For SC bowlers, non-SC batters get 0 runs
                else if (bowlerCardPlayed.type === "SC" && batterCardPlayed.type !== "SC") {
                    runsScored = 0;
                }
                // 4. For ST bowlers, non-ST batters get 0 runs
                else if (bowlerCardPlayed.type === "ST" && batterCardPlayed.type !== "ST") {
                    runsScored = 0;
                }
                // Otherwise, calculate runs based on the vote_share difference
                else {
                    // Calculate the difference
                    const difference = batterCardPlayed.vote_share - bowlerCardPlayed.vote_share;
                    
                    // Assign runs based on the difference ranges
                    if (difference >= 0 && difference < 3) {
                        runsScored = 0;
                    } else if (difference >= 3 && difference < 6) {
                        runsScored = 1;
                    } else if (difference >= 6 && difference < 9) {
                        runsScored = 2;
                    } else if (difference >= 9 && difference < 12) {
                        runsScored = 3;
                    } else if (difference >= 12 && difference < 15) {
                        runsScored = 4;
                    } else if (difference >= 15) {
                        runsScored = 6;
                    }
                }
            }
            
            // Store the outcome for next ball button
            lastBallOutcome = isWicket ? "WICKET!" : `${runsScored} RUN${runsScored !== 1 ? 'S' : ''}!`;
            lastBallRuns = runsScored;
            lastBallWicket = isWicket;
            
            // Set waiting for next ball
            waitingForNextBall = true;
            
            // Update scores
            if (userIsBatting) {
                if (isWicket) {
                    userWickets++;
                } else {
                    userRuns += runsScored;
                }
            } else {
                if (isWicket) {
                    compWickets++;
                } else {
                    compRuns += runsScored;
                }
            }
            
            // Show outcome area
            outcomeMessage.textContent = lastBallOutcome;
            outcomeMessage.className = `outcome-message ${isWicket ? 'wicket' : 'runs'}`;
            outcomeArea.classList.remove('hidden');
            
            // Log the result
            if (isWicket) {
                addLogEntry(`<span class="log-highlight">WICKET!</span> ${userIsBatting ? 'You' : 'Computer'} lost a wicket.`);
            } else {
                addLogEntry(`<span class="log-highlight">${runsScored} run${runsScored !== 1 ? 's' : ''}</span> scored by ${userIsBatting ? 'you' : 'computer'}.`);
            }
            
            // Update displays
            updateDisplays();
            
            // Check if over is complete
            if (balls % BALLS_PER_OVER === 0) {
                const currentOver = Math.floor(balls / BALLS_PER_OVER);
                const isLastOver = currentOver >= TOTAL_OVERS;
                
                addLogEntry(`<span class="log-highlight">End of over ${currentOver}</span>`);
                
                // If it's not the last over, allow bowler to discard and draw cards
                if (!isLastOver) {
                    if (userIsBowling) {
                        // If user is bowling, show the discard interface after they click next ball
                        nextBallBtn.textContent = "Manage Your Cards";
                        nextBallBtn.onclick = showDiscardInterface;
                    } else {
                        // If computer is bowling, automatically have computer discard and draw
                        // This will be handled in prepareNextBall for the computer
                    }
                }
            }
            
            // Check if innings/game is over (but don't proceed automatically)
            checkInningsStatus();
        }
        
        // Show discard interface for user
        function showDiscardInterface() {
            // Hide outcome area
            outcomeArea.classList.add('hidden');
            
            // Show discard interface
            discardArea.classList.remove('hidden');
            
            // Set instructions
            discardInstructionsText.textContent = "End of over! You can refresh your bowling hand.";
            
            // Reset discard count
            discardCount = 0;
            updateDiscardCounter();
            
            // Enable discard mode
            discardMode = true;
            
            // Update action text
            setActionText();
            
            // Render player cards in discard mode
            renderPlayerCards();
        }
        
        // Handle card discard for user
        function handleCardDiscard(index) {
            if (discardCount >= 2) return;
            
            // Remove the card from player's hand
            const discardedCard = playerCards.splice(index, 1)[0];
            
            // Draw a new card if available
            if (deck.length > 0) {
                playerCards.push(deck.shift());
            }
            
            // Increment discard count
            discardCount++;
            updateDiscardCounter();
            
            // Log the discard
            addLogEntry(`You discarded <span class="log-highlight">${discardedCard.name}</span> and drew a new card.`);
            
            // Render updated player cards
            renderPlayerCards();
            
            // Check if all discards are used
            if (discardCount >= 2) {
                // Automatically finish discard phase after a short delay
                setTimeout(finishDiscardPhase, 1000);
            }
        }
        
        // Update discard counter display
        function updateDiscardCounter() {
            discardCounterText.textContent = `${discardCount}/2 discards used`;
        }
        
        // Finish discard phase
        function finishDiscardPhase() {
            // Reset discard mode
            discardMode = false;
            
            // Hide discard interface
            discardArea.classList.add('hidden');
            
            // Reset next ball button
            nextBallBtn.textContent = "Next Ball";
            nextBallBtn.onclick = prepareNextBall;
            
            // Complete preparation for next ball
            completePrepareNextBall();
        }
        
        // Complete preparation for next ball (after discards if applicable)
        function completePrepareNextBall() {
            // Reset cards for next ball
            bowlerCardPlayed = null;
            batterCardPlayed = null;
            
            // Reset waiting state
            waitingForNextBall = false;
            
            // Reset card displays
            resetCardDisplays();
            
            // The bowler always plays first for the next ball
            if ((userIsBatting && !userIsBowling) || (!userIsBatting && !userIsBowling)) {
                // Computer is bowling
                computerPlaysBowlingCard();
            } else {
                // User is bowling
                setActionText();
            }
            
            // Update player cards to make them clickable again
            renderPlayerCards();
        }
        
        // Computer discard cards
        function computerDiscardCards() {
            // Computer discards up to 2 cards with lowest vote_share
            let discardsUsed = 0;
            
            while (discardsUsed < 2 && computerCards.length > 0 && deck.length > 0) {
                // Find the index of the card with lowest vote_share
                let lowestIndex = 0;
                for (let i = 1; i < computerCards.length; i++) {
                    if (computerCards[i].vote_share < computerCards[lowestIndex].vote_share) {
                        lowestIndex = i;
                    }
                }
                
                // Discard that card
                const discardedCard = computerCards.splice(lowestIndex, 1)[0];
                
                // Draw a new card
                computerCards.push(deck.shift());
                
                // Log the discard
                addLogEntry(`Computer discarded a card and drew a new card.`);
                
                discardsUsed++;
            }
        }
        
        // Prepare for the next ball
        function prepareNextBall() {
            if (gameOver) return;
            
            // Check if we just completed an over (except the last one)
            const currentOver = Math.floor((balls - 1) / BALLS_PER_OVER) + 1; // +1 because we need the over we just completed
            const ballInOver = ((balls - 1) % BALLS_PER_OVER) + 1; // +1 to get 1-based ball number
            
            // If we just completed a full over and it's not the last over
            if (ballInOver === BALLS_PER_OVER && currentOver < TOTAL_OVERS) {
                if (!userIsBowling) {
                    // If computer is bowling, perform computer's discards
                    computerDiscardCards();
                    completePrepareNextBall();
                } else {
                    // User bowling - handled in the showDiscardInterface function
                    showDiscardInterface();
                }
            } else {
                // Not an over boundary, just prepare the next ball normally
                // Hide outcome area
                outcomeArea.classList.add('hidden');
                completePrepareNextBall();
            }
        }
        
        // Check if innings or game is over
        function checkInningsStatus() {
            const oversCompleted = Math.floor(balls / BALLS_PER_OVER);
            const currentWickets = userIsBatting ? userWickets : compWickets;
            
            // Check if innings is over
            const inningsOver = oversCompleted >= TOTAL_OVERS || currentWickets >= TOTAL_WICKETS;
            
            // Check if target has been achieved in second innings
            let targetAchieved = false;
            if (currentInnings === 2) {
                const currentRuns = userIsBatting ? userRuns : compRuns;
                targetAchieved = currentRuns >= target;
            }
            
            // If innings is over or target achieved
            if (inningsOver || targetAchieved) {
                // If first innings is over
                if (currentInnings === 1 && !targetAchieved) {
                    currentInnings = 2;
                    
                    // Set target for second innings
                    if (userIsBatting) {
                        target = userRuns + 1;
                        addLogEntry(`<span class="log-highlight">First innings over!</span> Computer needs ${target} runs to win.`);
                    } else {
                        target = compRuns + 1;
                        addLogEntry(`<span class="log-highlight">First innings over!</span> You need ${target} runs to win.`);
                    }
                    
                    // Add this message to the outcome
                    const inningsMessage = userIsBatting ? 
                        `Your innings is over! You scored ${userRuns}/${userWickets} in ${oversCompleted}.${balls % BALLS_PER_OVER} overs.` :
                        `Computer's innings is over! They scored ${compRuns}/${compWickets} in ${oversCompleted}.${balls % BALLS_PER_OVER} overs.`;
                    
                    outcomeMessage.textContent = inningsMessage;
                    
                    // Change next ball button text
                    nextBallBtn.textContent = "Start Second Innings";
                    
                    // After clicking next ball, we'll switch roles and prepare for second innings
                } else {
                    // Game is over - show the final result
                    endGame();
                }
            }
        }
        
        // End the game
        function endGame() {
            gameOver = true;
            
            // Determine the winner
            let winner = '';
            let winMessage = '';
            
            if (currentInnings === 2) {
                const userBattedSecond = userIsBatting;
                const compBattedSecond = !userIsBatting;
                
                if ((userBattedSecond && userRuns >= target) || (compBattedSecond && compRuns < target)) {
                    winner = 'You';
                    winMessage = `You won by ${TOTAL_WICKETS - userWickets} wickets!`;
                } else if ((compBattedSecond && compRuns >= target) || (userBattedSecond && userRuns < target)) {
                    winner = 'Computer';
                    winMessage = `Computer won by ${TOTAL_WICKETS - compWickets} wickets!`;
                } else {
                    // This shouldn't happen with the current logic, but just in case
                    winner = 'Nobody';
                    winMessage = 'The game ended in a tie!';
                }
            } else {
                // If game ended after first innings (shouldn't happen with current logic)
                winner = userRuns > compRuns ? 'You' : 'Computer';
                winMessage = `${winner} won the game!`;
            }
            
            // Hide the outcome area
            outcomeArea.classList.add('hidden');
            
            // Show winner in result display
            resultDisplay.textContent = `${winner} won the match!`;
            
            // Set final scorecard in the modal
            const userOvers = `${Math.floor(balls / BALLS_PER_OVER)}.${balls % BALLS_PER_OVER}`;
            finalUserScore.textContent = `${userRuns}/${userWickets} (${userOvers})`;
            finalCompScore.textContent = `${compRuns}/${compWickets} (${compOvers})`;
            finalResult.textContent = winMessage;
            
            // Show modal with game result
            modalMessage.textContent = winMessage;
            gameOverModal.style.display = 'flex';
            
            // Log the result
            addLogEntry(`<span class="log-highlight">GAME OVER!</span> ${winMessage}`);
        }
        
        // Reset card displays
        function resetCardDisplays() {
            bowlerCardDisplay.innerHTML = `
                <div class="card-header">Select a card to start</div>
                <img src="/api/placeholder/400/180" alt="Candidate Photo" class="player-image">
                <div class="card-body">
                    <div class="card-info">
                        <span class="info-label">Party:</span>
                        <span class="info-value party-tag">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Age:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Gender:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Vote Share:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Rank:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Constituency:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">State:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Type:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Turnout:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Margin:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Female Turnout Edge:</span>
                        <span class="info-value">-</span>
                    </div>
                </div>
            `;
            
            batterCardDisplay.innerHTML = `
                <div class="card-header">Select a card to start</div>
                <img src="/api/placeholder/400/180" alt="Candidate Photo" class="player-image">
                <div class="card-body">
                    <div class="card-info">
                        <span class="info-label">Party:</span>
                        <span class="info-value party-tag">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Age:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Gender:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Vote Share:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Rank:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Constituency:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">State:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Type:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Turnout:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Margin:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="card-info">
                        <span class="info-label">Female Turnout Edge:</span>
                        <span class="info-value">-</span>
                    </div>
                </div>
            `;
        }
        
        // Set action text based on current game state
        function setActionText() {
            if (discardMode) {
                actionTextDisplay.textContent = 'Select cards to discard (up to 2)';
            } else if (waitingForNextBall) {
                actionTextDisplay.textContent = 'Click "Next Ball" to continue';
            } else if (userIsBowling && !bowlerCardPlayed) {
                actionTextDisplay.textContent = 'Your turn to bowl! Select a card';
            } else if (userIsBatting && bowlerCardPlayed) {
                actionTextDisplay.textContent = 'Your turn to bat! Select a card';
            } else if (userIsBatting && !bowlerCardPlayed) {
                actionTextDisplay.textContent = 'Please wait for the computer to bowl';
            } else if (userIsBowling && bowlerCardPlayed) {
                actionTextDisplay.textContent = 'Please wait for the computer to bat';
            }
        }
        
        // Add an entry to the game log
        function addLogEntry(text) {
            const entryElement = document.createElement('div');
            entryElement.className = 'log-entry';
            entryElement.innerHTML = text;
            
            logEntriesDisplay.prepend(entryElement);
        }
        
        // Update all displays with current game state
        function updateDisplays() {
            userRunsDisplay.textContent = userRuns;
            userWicketsDisplay.textContent = userWickets;
            compRunsDisplay.textContent = compRuns;
            compWicketsDisplay.textContent = compWickets;
            
            // Calculate overs (e.g. 2.3 means 2 overs and 3 balls)
            const totalBalls = balls;
            const userBalls = userIsBatting ? totalBalls : (currentInnings === 2 ? totalBalls : 0);
            const compBalls = !userIsBatting ? totalBalls : (currentInnings === 2 ? totalBalls : 0);
            
            const userOvers = `${Math.floor(userBalls / BALLS_PER_OVER)}.${userBalls % BALLS_PER_OVER}`;
            const compOvers = `${Math.floor(compBalls / BALLS_PER_OVER)}.${compBalls % BALLS_PER_OVER}`;
            
            userOversDisplay.textContent = userOvers;
            compOversDisplay.textContent = compOvers;
            
            // Update current over and ball display for current innings
            const currentOver = `${Math.floor(totalBalls / BALLS_PER_OVER)}.${totalBalls % BALLS_PER_OVER}`;
            currentOverDisplay.textContent = currentOver;
            ballCountDisplay.textContent = totalBalls;
            
            // Update target and required runs if available
            if (target) {
                targetRunsDisplay.textContent = target;
                
                const currentRuns = userIsBatting ? userRuns : compRuns;
                const requiredRuns = Math.max(0, target - currentRuns);
                
                reqRunsDisplay.textContent = requiredRuns;
                
                // If game is in second innings, add info about required runs
                if (currentInnings === 2) {
                    const remainingBalls = (TOTAL_OVERS * BALLS_PER_OVER) - totalBalls;
                    const remainingWickets = TOTAL_WICKETS - (userIsBatting ? userWickets : compWickets);
                    
                    if (requiredRuns > 0) {
                        resultDisplay.textContent = `${userIsBatting ? 'You need' : 'Computer needs'} ${requiredRuns} runs from ${remainingBalls} balls with ${remainingWickets} wickets remaining`;
                    } else {
                        resultDisplay.textContent = '';
                    }
                } else {
                    resultDisplay.textContent = '';
                }
            } else {
                targetRunsDisplay.textContent = '-';
                reqRunsDisplay.textContent = '-';
                resultDisplay.textContent = '';
            }
            
            // Calculate and update run rate
            if (totalBalls > 0) {
                const currentRuns = userIsBatting ? userRuns : compRuns;
                const runRate = (currentRuns / totalBalls) * 6;
                runRateDisplay.textContent = runRate.toFixed(2);
            } else {
                runRateDisplay.textContent = '0.00';
            }
            
            // Update action text based on waiting state
            setActionText();
        }
        
        // Reset the game to initial state
        function resetGame() {
            // Reset game state variables
            userIsBatting = false;
            userIsBowling = false;
            currentInnings = 1;
            userRuns = 0;
            userWickets = 0;
            compRuns = 0;
            compWickets = 0;
            balls = 0;
            target = null;
            bowlerCardPlayed = null;
            batterCardPlayed = null;
            gameOver = false;
            waitingForNextBall = false;
            discardMode = false;
            discardCount = 0;
            
            // Reset displays
            resetCardDisplays();
            resultDisplay.textContent = '';
            outcomeArea.classList.add('hidden');
            discardArea.classList.add('hidden');
            nextBallBtn.textContent = "Next Ball";
            nextBallBtn.onclick = prepareNextBall;
            
            // Clear log
            logEntriesDisplay.innerHTML = '';
            
            // Hide game screen and modal
            gameScreen.classList.add('hidden');
            gameOverModal.style.display = 'none';
            
            // Show start screen
            startScreen.classList.remove('hidden');
            
            // Reset innings indicators
            userInningsIndicator.classList.add('hidden');
            compInningsIndicator.classList.add('hidden');
        }
        
        // Initialize the game when page loads
        window.addEventListener('load', async function() {
            console.log("Window loaded, initializing game...");
            await initGame();
            console.log("Game initialization complete, ready to start");
        });
    </script>
</body>
</html>
