<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Card Game - Lok Sabha Elections 2024</title>
    <style>
        :root {
            --primary-color: #FF9933; /* Saffron from Indian flag */
            --secondary-color: #138808; /* Green from Indian flag */
            --neutral-color: #f4f4f4;
            --dark-color: #333;
            --light-color: #fff;
            --accent-color: #000080; /* Navy blue */
            --win-color: #4CAF50;
            --lose-color: #f44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f0f0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .score-container, .deck-info {
            text-align: center;
        }

        .action-area {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 20px;
        }

        .played-cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex: 2;
        }

        .versus {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .round-result {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .players-area {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .player {
            flex: 1;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .player-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--accent-color);
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-color);
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .card {
            width: 160px;
            height: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            background-color: var(--light-color);
            transition: transform 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.selected {
            border: 3px solid var(--accent-color);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
            background-color: var(--primary-color);
            color: var(--light-color);
        }

        .card-id {
            font-size: 10px;
        }

        .card-party {
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 3px;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .card-photo {
            width: 100%;
            height: 110px;
            object-fit: cover;
            border-bottom: 1px solid #ddd;
        }

        .card-details {
            padding: 10px;
        }

        .card-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            height: 30px;
            overflow: hidden;
        }

        .card-location {
            font-size: 11px;
            color: var(--dark-color);
            margin-bottom: 5px;
            font-style: italic;
        }

        .card-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 11px;
        }

        .card-stat {
            display: flex;
            justify-content: space-between;
        }

        .card-stat-label {
            color: #666;
        }

        .card-stat-value {
            font-weight: bold;
        }

        .highlight {
            background-color: yellow;
            padding: 0 2px;
        }

        .card-badges {
            position: absolute;
            top: 35px;
            right: 5px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .badge {
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            color: white;
            background-color: var(--accent-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .badge.incumbent {
            background-color: var(--secondary-color);
        }

        .badge.previous {
            background-color: var(--primary-color);
        }

        .badge.winner {
            background-color: var(--win-color);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: var(--accent-color);
            color: var(--light-color);
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #000066;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #resetButton {
            background-color: var(--lose-color);
        }

        #resetButton:hover {
            background-color: #d32f2f;
        }

        .winning-stat {
            background-color: rgba(76, 175, 80, 0.2);
        }

        .turn-indicator {
            font-weight: bold;
            font-size: 18px;
            text-align: center;
            margin-bottom: 10px;
            color: var(--accent-color);
        }

        .hidden {
            display: none;
        }

        #gameLogContainer {
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            background-color: var(--light-color);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .action-area, .players-area {
                flex-direction: column;
            }

            .card {
                width: 140px;
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cricket Card Game - Lok Sabha Elections 2024</h1>
            <p>A strategic card game based on election candidates</p>
        </header>

        <div class="game-info">
            <div class="score-container">
                <h3>Score</h3>
                <p>Bowler: <span id="bowlerScore">0</span> runs</p>
                <p>Batter: <span id="batterScore">0</span> runs</p>
            </div>
            <div class="deck-info">
                <h3>Deck</h3>
                <p>Cards remaining: <span id="cardsRemaining">1270</span></p>
            </div>
        </div>

        <div class="turn-indicator" id="turnIndicator">Bowler's turn to play</div>

        <div class="action-area">
            <div class="played-cards">
                <div id="bowlerPlayedCard" class="card hidden">
                    <!-- Bowler's played card will appear here -->
                </div>
                <div class="versus hidden" id="versusText">VS</div>
                <div id="batterPlayedCard" class="card hidden">
                    <!-- Batter's played card will appear here -->
                </div>
            </div>
            <div class="round-result">
                <h3>Round Result</h3>
                <p id="roundResult">Play cards to see the result</p>
                <div class="controls">
                    <button id="newRoundButton" disabled>Next Round</button>
                </div>
            </div>
        </div>

        <div class="players-area">
            <div class="player" id="bowlerArea">
                <h2 class="player-title">Bowler</h2>
                <div class="cards" id="bowlerCards">
                    <!-- Bowler's cards will appear here -->
                </div>
            </div>
            <div class="player" id="batterArea">
                <h2 class="player-title">Batter</h2>
                <div class="cards" id="batterCards">
                    <!-- Batter's cards will appear here -->
                </div>
            </div>
        </div>

        <div id="gameLogContainer">
            <h3>Game Log</h3>
            <div id="gameLog"></div>
        </div>

        <div class="controls">
            <button id="resetButton">Reset Game</button>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            deck: [],
            bowlerHand: [],
            batterHand: [],
            bowlerScore: 0,
            batterScore: 0,
            currentTurn: 'bowler', // 'bowler' or 'batter'
            roundActive: false,
            bowlerPlayedCard: null,
            batterPlayedCard: null,
            gameLog: []
        };

        // DOM Elements
        const bowlerCardsEl = document.getElementById('bowlerCards');
        const batterCardsEl = document.getElementById('batterCards');
        const bowlerPlayedCardEl = document.getElementById('bowlerPlayedCard');
        const batterPlayedCardEl = document.getElementById('batterPlayedCard');
        const versusTextEl = document.getElementById('versusText');
        const bowlerScoreEl = document.getElementById('bowlerScore');
        const batterScoreEl = document.getElementById('batterScore');
        const cardsRemainingEl = document.getElementById('cardsRemaining');
        const roundResultEl = document.getElementById('roundResult');
        const turnIndicatorEl = document.getElementById('turnIndicator');
        const newRoundButtonEl = document.getElementById('newRoundButton');
        const resetButtonEl = document.getElementById('resetButton');
        const gameLogEl = document.getElementById('gameLog');

        // Party colors
        const partyColors = {
            'BJP': '#FF9933',
            'INC': '#0078D7',
            'AITC': '#4CAF50',
            'YSRCP': '#9C27B0',
            'DMK': '#FF5722',
            'AAP': '#00BCD4',
            'JD(U)': '#8BC34A',
            'BSP': '#3F51B5',
            'BJD': '#009688',
            'LJSP': '#795548',
            'TDP': '#FFEB3B',
            'NCP': '#607D8B',
            'SS': '#FFC107',
            'JMM': '#E91E63',
            'SP': '#F44336',
            'CPI(M)': '#B71C1C',
            'SHIVSENA': '#FFA000',
            'RJD': '#43A047',
            'NPP': '#1976D2',
            'OTHERS': '#9E9E9E'
        };

        // Statistics to compare
        const winningStats = [
            { name: 'vote_share', label: 'Vote Share', direction: 'higher' },
            { name: 'margin', label: 'Margin', direction: 'higher' },
            { name: 'turnout', label: 'Turnout', direction: 'higher' },
            { name: 'age', label: 'Age', direction: 'higher' },
        ];

        // Initialize game
        async function initGame() {
            // Load all card IDs
            const totalCards = 1282;
            const cardIds = Array.from({ length: totalCards }, (_, i) => i + 1);
            
            // Shuffle the card IDs
            shuffleArray(cardIds);
            
            // Set the deck with shuffled IDs (we'll load the actual data when needed)
            gameState.deck = cardIds;
            updateCardsRemaining();
            
            // Deal initial hands
            await dealInitialHands();
            
            // Render initial game state
            renderGameState();
            
            // Add event listener for new round button
            newRoundButtonEl.addEventListener('click', startNewRound);
            
            // Add event listener for reset button
            resetButtonEl.addEventListener('click', resetGame);
            
            // Log game start
            addToGameLog('Game started! Bowler goes first.');
        }

        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Deal initial hands
        async function dealInitialHands() {
            // Deal 6 cards to bowler
            for (let i = 0; i < 6; i++) {
                const cardId = gameState.deck.shift();
                const cardData = await fetchCardData(cardId);
                gameState.bowlerHand.push(cardData);
            }
            
            // Deal 6 cards to batter
            for (let i = 0; i < 6; i++) {
                const cardId = gameState.deck.shift();
                const cardData = await fetchCardData(cardId);
                gameState.batterHand.push(cardData);
            }
            
            updateCardsRemaining();
        }

        // Fetch card data from JSON file
        async function fetchCardData(cardId) {
            try {
                const response = await fetch(`./cards/${cardId}.json`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch card ${cardId}`);
                }
                return await response.json();
            } catch (error) {
                console.error(error);
                // Return dummy card data if fetch fails
                return {
                    id: cardId,
                    name: `Card ${cardId}`,
                    photo: "/api/placeholder/160/110",
                    age: 45,
                    gender: "MALE",
                    party: "OTHERS",
                    incumbent: 0,
                    previous_member: 0,
                    vote_share: 35,
                    rank: 2,
                    constituency: "Unknown",
                    state: "Unknown",
                    constituency_category: "GEN",
                    voters: 1000000,
                    turnout: 70,
                    male_turnout: 68,
                    female_turnout: 72,
                    winner_share: 40,
                    margin: 5,
                    nota_share: 1
                };
            }
        }

        // Render game state
        function renderGameState() {
            // Render player hands
            renderHand(gameState.bowlerHand, bowlerCardsEl, 'bowler');
            renderHand(gameState.batterHand, batterCardsEl, 'batter');
            
            // Update scores
            bowlerScoreEl.textContent = gameState.bowlerScore;
            batterScoreEl.textContent = gameState.batterScore;
            
            // Update turn indicator
            if (gameState.roundActive) {
                if (gameState.currentTurn === 'bowler') {
                    turnIndicatorEl.textContent = "Bowler's turn to play";
                } else {
                    turnIndicatorEl.textContent = "Batter's turn to play";
                }
            } else {
                turnIndicatorEl.textContent = "Preparing for next round";
            }
            
            // Show/hide played cards
            if (gameState.bowlerPlayedCard) {
                bowlerPlayedCardEl.innerHTML = createCardHTML(gameState.bowlerPlayedCard, 'bowler', true);
                bowlerPlayedCardEl.classList.remove('hidden');
                versusTextEl.classList.remove('hidden');
            } else {
                bowlerPlayedCardEl.classList.add('hidden');
                versusTextEl.classList.add('hidden');
            }
            
            if (gameState.batterPlayedCard) {
                batterPlayedCardEl.innerHTML = createCardHTML(gameState.batterPlayedCard, 'batter', true);
                batterPlayedCardEl.classList.remove('hidden');
            } else {
                batterPlayedCardEl.classList.add('hidden');
            }
            
            // Enable/disable new round button
            newRoundButtonEl.disabled = gameState.roundActive;
        }

        // Render a player's hand
        function renderHand(hand, containerElement, player) {
            containerElement.innerHTML = '';
            hand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.innerHTML = createCardHTML(card, player);
                cardElement.dataset.index = index;
                
                // Add click event for playing cards
                cardElement.addEventListener('click', () => {
                    if (gameState.currentTurn === player && gameState.roundActive) {
                        playCard(player, index);
                    }
                });
                
                containerElement.appendChild(cardElement);
            });
        }

        // Create HTML for a card
        function createCardHTML(card, player, isPlayed = false) {
            // Get party color or default
            const partyColor = partyColors[card.party] || '#9E9E9E';
            
            // Create badges
            let badges = '';
            if (card.incumbent === 1) {
                badges += '<div class="badge incumbent">Incumbent</div>';
            }
            if (card.previous_member === 1) {
                badges += '<div class="badge previous">Previous MP</div>';
            }
            if (card.rank === 1) {
                badges += '<div class="badge winner">Winner</div>';
            }
            
            // Highlight winning stat if this is a played card
            let statsHTML = '';
            winningStats.forEach(stat => {
                const isWinningStat = isPlayed && gameState.bowlerPlayedCard && gameState.batterPlayedCard && 
                                    ((stat.direction === 'higher' && card[stat.name] > (player === 'bowler' ? gameState.batterPlayedCard[stat.name] : gameState.bowlerPlayedCard[stat.name])) || 
                                    (stat.direction === 'lower' && card[stat.name] < (player === 'bowler' ? gameState.batterPlayedCard[stat.name] : gameState.bowlerPlayedCard[stat.name])));
                
                statsHTML += `
                    <div class="card-stat ${isWinningStat ? 'winning-stat' : ''}">
                        <span class="card-stat-label">${stat.label}:</span>
                        <span class="card-stat-value">${formatStatValue(stat.name, card[stat.name])}</span>
                    </div>
                `;
            });
            
            return `
                <div class="card-header" style="background-color: ${partyColor};">
                    <span class="card-id">#${card.id}</span>
                    <span class="card-party">${card.party}</span>
                </div>
                <img src="${card.photo}" alt="${card.name}" class="card-photo" onerror="this.src='/api/placeholder/160/110'">
                <div class="card-badges">
                    ${badges}
                </div>
                <div class="card-details">
                    <div class="card-name">${card.name}</div>
                    <div class="card-location">${card.constituency}, ${card.state}</div>
                    <div class="card-stats">
                        ${statsHTML}
                    </div>
                </div>
            `;
        }

        // Format stat value for display
        function formatStatValue(statName, value) {
            if (statName.includes('share') || statName.includes('turnout') || statName === 'margin') {
                return value + '%';
            }
            return value;
        }

        // Play a card
        function playCard(player, cardIndex) {
            if (player === 'bowler') {
                gameState.bowlerPlayedCard = gameState.bowlerHand[cardIndex];
                gameState.bowlerHand.splice(cardIndex, 1);
                gameState.currentTurn = 'batter';
                addToGameLog(`Bowler played: ${gameState.bowlerPlayedCard.name} (${gameState.bowlerPlayedCard.party})`);
            } else {
                gameState.batterPlayedCard = gameState.batterHand[cardIndex];
                gameState.batterHand.splice(cardIndex, 1);
                gameState.roundActive = false;
                addToGameLog(`Batter played: ${gameState.batterPlayedCard.name} (${gameState.batterPlayedCard.party})`);
                
                // Determine the winner of the round
                determineRoundWinner();
            }
            
            renderGameState();
        }

        // Determine the winner of the round
        function determineRoundWinner() {
            const bowlerCard = gameState.bowlerPlayedCard;
            const batterCard = gameState.batterPlayedCard;
            
            let bowlerWins = 0;
            let batterWins = 0;
            let roundPoints = 0;
            
            // Compare each stat
            winningStats.forEach(stat => {
                if (stat.direction === 'higher') {
                    if (bowlerCard[stat.name] > batterCard[stat.name]) {
                        bowlerWins++;
                    } else if (batterCard[stat.name] > bowlerCard[stat.name]) {
                        batterWins++;
                    }
                } else {
                    if (bowlerCard[stat.name] < batterCard[stat.name]) {
                        bowlerWins++;
                    } else if (batterCard[stat.name] < bowlerCard[stat.name]) {
                        batterWins++;
                    }
                }
            });
            
            // Determine points based on wins
            if (bowlerWins > batterWins) {
                roundPoints = bowlerWins - batterWins;
                gameState.bowlerScore += roundPoints;
                roundResultEl.textContent = `Bowler wins! +${roundPoints} runs. (${bowlerWins}-${batterWins})`;
                addToGameLog(`Bowler wins round with ${bowlerWins} stats to ${batterWins}. +${roundPoints} runs.`);
            } else if (batterWins > bowlerWins) {
                roundPoints = batterWins - bowlerWins;
                gameState.batterScore += roundPoints;
                roundResultEl.textContent = `Batter wins! +${roundPoints} runs. (${batterWins}-${bowlerWins})`;
                addToGameLog(`Batter wins round with ${batterWins} stats to ${bowlerWins}. +${roundPoints} runs.`);
            } else {
                roundResultEl.textContent = `It's a tie! No runs scored. (${bowlerWins}-${batterWins})`;
                addToGameLog(`Round tied with ${bowlerWins} stats each. No runs scored.`);
            }
            
            // Enable the new round button
            newRoundButtonEl.disabled = false;
        }

        // Start a new round
        async function startNewRound() {
            // Clear played cards
            gameState.bowlerPlayedCard = null;
            gameState.batterPlayedCard = null;
            
            // Deal a new card to each player
            if (gameState.deck.length >= 2) {
                try {
                    // Deal to bowler
                    const bowlerCardId = gameState.deck.shift();
                    const bowlerCardData = await fetchCardData(bowlerCardId);
                    gameState.bowlerHand.push(bowlerCardData);
                    
                    // Deal to batter
                    const batterCardId = gameState.deck.shift();
                    const batterCardData = await fetchCardData(batterCardId);
                    gameState.batterHand.push(batterCardData);
                    
                    updateCardsRemaining();
                    addToGameLog('New cards dealt. Starting next round.');
                } catch (error) {
                    console.error("Error dealing new cards:", error);
                    addToGameLog('Error dealing new cards. Try resetting the game.');
                }
            } else {
                // Not enough cards left
                addToGameLog('Not enough cards left in the deck! Game over.');
                roundResultEl.textContent = 'Game over! Not enough cards left.';
                return;
            }
            
            // Reset for next round
            gameState.currentTurn = 'bowler';
            gameState.roundActive = true;
            roundResultEl.textContent = 'Play cards to see the result';
            
            // Render updated state
            renderGameState();
        }

        // Reset the game
        function resetGame() {
            // Reset game state
            gameState = {
                deck: [],
                bowlerHand: [],
                batterHand: [],
                bowlerScore: 0,
                batterScore: 0,
                currentTurn: 'bowler',
                roundActive: true,
                bowlerPlayedCard: null,
                batterPlayedCard: null,
                gameLog: []
            };
            
            // Clear UI
            bowlerCardsEl.innerHTML = '';
            batterCardsEl.innerHTML = '';
            bowlerPlayedCardEl.classList.add('hidden');
            batterPlayedCardEl.classList.add('hidden');
            versusTextEl.classList.add('hidden');
            roundResultEl.textContent = 'Play cards to see the result';
            gameLogEl.innerHTML = '';
            
            // Reinitialize game
            initGame();
            
            addToGameLog('Game reset! Starting new game.');
        }

        // Update cards remaining display
        function updateCardsRemaining() {
            cardsRemainingEl.textContent = gameState.deck.length;
        }

        // Add entry to game log
        function addToGameLog(message) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = message;
            gameLogEl.prepend(logEntry);
            
            // Store in game state
            gameState.gameLog.push(message);
        }

        // Start the game when page loads
        window.addEventListener('DOMContentLoaded', () => {
            gameState.roundActive = true;
            initGame();
        });
    </script>
</body>
</html>
